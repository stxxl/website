<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>STXXL: Priority Queue</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">STXXL
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('design_pqueue.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Priority Queue </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Roman Dementiev (2006)</dd></dl>
<p>A priority queue is a data structure that provides a restricted subset of container functionality: it provides insertion of elements, and inspection and removal of the top element. It is guaranteed that the top element is the largest element in the priority queue, where the function object Cmp is used for comparisons. Priority queues do not allow iteration through its elements.</p>
<p>External memory priority queues are the central data structures for many I/O efficient graph algorithms (<a class="el" href="citelist.html#CITEREF_ZehPhd">[58]</a> <a class="el" href="citelist.html#CITEREF_ChiEtAl95">[21]</a> <a class="el" href="citelist.html#CITEREF_MSS03">[40]</a>). The main technique in these algorithms is time-forward processing (<a class="el" href="citelist.html#CITEREF_ChiEtAl95">[21]</a> <a class="el" href="citelist.html#CITEREF_Arg95">[10]</a>), easily realizable by an I/O efficient priority queue. I/O efficient priority queues also find application in large-scale discrete event simulation and online sorting. The STXXL implementation of priority queues is based on <a class="el" href="citelist.html#CITEREF_San00b">[50]</a>. An operation of this priority queue, called sequence heap, takes <img class="formulaInl" alt="$ \mathcal{O}(\frac{1}{B}\log_{M/B}(I/B)) $" src="form_17.png"/> amortized I/Os, where <img class="formulaInl" alt="$ I $" src="form_18.png"/> is the total number of insertions into the priority queue. This queue needs less than a third of I/Os used by other similar cache (I/O) efficient priority queues (e.g. <a class="el" href="citelist.html#CITEREF_Brengel00">[15]</a> <a class="el" href="citelist.html#CITEREF_FJKT97">[30]</a>). The amortized run time of the STXXL priority queue are </p>
<table class="doxtable">
<tr>
<th>operation </th><th>internal work </th><th>I/O (amortized)  </th></tr>
<tr>
<td>insertion </td><td><img class="formulaInl" alt="$ \mathcal{O}(\log I) $" src="form_19.png"/> </td><td><img class="formulaInl" alt="$ \mathcal{O}(1/B) $" src="form_20.png"/> </td></tr>
<tr>
<td>deletion </td><td><img class="formulaInl" alt="$ \mathcal{O}(\log I) $" src="form_19.png"/> </td><td><img class="formulaInl" alt="$ \mathcal{O}(1/B) $" src="form_20.png"/> </td></tr>
</table>
<p>where <img class="formulaInl" alt="$ I $" src="form_18.png"/> is the number of performed operations.</p>
<p>A sequence heap maintains <em>R</em> <b>merge groups</b> <img class="formulaInl" alt="$ G_1,\ldots, G_R $" src="form_21.png"/> where <img class="formulaInl" alt="$ G_i $" src="form_22.png"/> holds up to <em>k</em> sorted sequences of size up to <img class="formulaInl" alt="$ m k^{i-1} $" src="form_23.png"/>, <img class="formulaInl" alt="$ m << M $" src="form_24.png"/>, see following figure. When group <img class="formulaInl" alt="$ G_i $" src="form_22.png"/> overflows, all its sequences are merged, and the resulting sequence is put into group <img class="formulaInl" alt="$ G_{i+1} $" src="form_25.png"/>. Each group is equipped with a <b>group buffer</b> of size <em>m</em> to allow batched deletion from the sequences. The smallest elements of these buffers are deleted in small batches and stored in the <b>deletion buffer</b>. The elements are first inserted into the <b>insertion priority queue</b>. On deletion, one checks the minimum elements stored in the insertion priority queue and the deletion buffer.</p>
<p>The difference of our implementation to <a class="el" href="citelist.html#CITEREF_San00b">[50]</a> is that a number of larger merge groups are explicitly kept in external memory. The sorted sequences in those groups only hold their <b>first</b> blocks in the main memory. The implementation supports parallel disks and overlaps I/O and computation. As in <a class="el" href="citelist.html#CITEREF_San00b">[50]</a>, the internal merging is based on loser trees <a class="el" href="citelist.html#CITEREF_Knu98">[38]</a>. However, our implementation does not use <b>sentinel</b> elements.</p>
<div class="image">
<img src="san00b_pqueue_small.png" alt="san00b_pqueue_small.png"/>
<div class="caption">
The structure of STXXL priority queue</div></div>
 <h1><a class="anchor" id="design_pqueue_generator"></a>
stxxl::PRIORITY_QUEUE_GENERATOR</h1>
<p>Since the <a class="el" href="classstxxl_1_1priority__queue.html">stxxl::priority_queue</a> has many setup parameters (internal memory buffer sizes, arity of mergers, number of internal and external memory merger groups, etc.) which are difficult to guess, STXXL provides a helper meta template program that searches for the optimum settings for user demands. This is necessary to limit the amount of main memory occupied by the different buffers of the data structure. The program is called <a class="el" href="classstxxl_1_1PRIORITY__QUEUE__GENERATOR.html">stxxl::PRIORITY_QUEUE_GENERATOR</a>.</p>
<p>The <a class="el" href="classstxxl_1_1PRIORITY__QUEUE__GENERATOR.html">stxxl::PRIORITY_QUEUE_GENERATOR</a> has the following template parameters:</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">ValueType</td><td>type of the contained objects (POD with no references to internal memory)</td></tr>
    <tr><td class="paramname">CompareType</td><td>the comparator type used to determine whether one element is smaller than another element.</td></tr>
    <tr><td class="paramname">IntMemory</td><td>upper limit for internal memory consumption in bytes.</td></tr>
    <tr><td class="paramname">MaxItems</td><td>upper limit for number of elements contained in the priority queue (in 1024 units). <br/>
 Example: if you are sure that priority queue contains no more than one million elements in a time, then the right parameter is (1000000 / 1024) = 976.</td></tr>
    <tr><td class="paramname">Tune</td><td>tuning parameter for meta-program search. <br/>
 Try to play with it if the code does not compile (larger than default values might help). Code does not compile if no suitable internal parameters were found for given IntMemory and MaxItems. It might also happen that given IntMemory is too small for given MaxItems, try larger values.</td></tr>
  </table>
  </dd>
</dl>
<h2>Notes</h2>
<ul>
<li>If <code>CompareType(x,y)</code> is true, then x is smaller than y. The element returned by <code>Q.top()</code> is the largest element in the priority queue. That is, it has the property that, for every other element <b>x</b> in the priority queue, <code>CompareType</code>(Q.top(),x) is false. <code>CompareType</code> must also provide <code>min_value()</code> method, that returns value of type ValueType that is smaller than any element of the queue <b>x</b>, i.e. <code>CompareType</code>(CompareType.min_value(),x) is always <b>true</b>. <br/>
 Example: comparison object for priority queue where <code>top()</code> returns the <b>smallest</b> contained integer: <div class="fragment"><div class="line"><span class="keyword">struct </span>CmpIntGreater</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> operator () (<span class="keyword">const</span> <span class="keywordtype">int</span> &amp; a, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> a &gt; b; }</div>
<div class="line">    <span class="keywordtype">int</span> min_value()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="uint__types_8h.html#a0cfacbbf6e846521326f5de5ba3ecd05">std::numeric_limits&lt;int&gt;::max</a>(); }</div>
<div class="line">};</div>
</div><!-- fragment --> Example: comparison object for priority queue where <code>top()</code> returns the <b>largest</b> contained integer: <div class="fragment"><div class="line"><span class="keyword">struct </span>CmpIntLess</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">bool</span> operator () (<span class="keyword">const</span> <span class="keywordtype">int</span> &amp; a, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp; b)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> a &lt; b; }</div>
<div class="line">    <span class="keywordtype">int</span> min_value()<span class="keyword"> const  </span>{ <span class="keywordflow">return</span> <a class="code" href="uint__types_8h.html#a969c1286bbe8eeb8811dac7a462d4a78">std::numeric_limits&lt;int&gt;::min</a>(); }</div>
<div class="line">};</div>
</div><!-- fragment --> Note that <code>CompareType</code> must define strict weak ordering. (<a href="http://www.sgi.com/tech/stl/StrictWeakOrdering.html">see what it is</a>)</li>
<li><a class="el" href="classstxxl_1_1PRIORITY__QUEUE__GENERATOR.html" title="Priority queue type generator.   Introduction  to priority queue container: see STXXL Priority Queue ...">stxxl::PRIORITY_QUEUE_GENERATOR</a> is template meta program that searches for <b>7</b> configuration parameters of <b><a class="el" href="classstxxl_1_1priority__queue.html" title="External priority queue data structure   Introduction  to priority queue container: see STXXL Priorit...">stxxl::priority_queue</a></b> that both minimize internal memory consumption of the priority queue to match <code>IntMemory</code> and maximize performance of priority queue operations. Actual memory consumption might be larger (use <a class="el" href="classstxxl_1_1priority__queue.html#ab1cd023d51e7b12ccc4648522a3a63eb">stxxl::priority_queue::mem_cons()</a> method to track it), since the search assumes rather optimistic schedule of push'es and pop'es for the estimation of the maximum memory consumption. To keep actual memory requirements low increase the value of <code>MaxItems</code> parameter.</li>
<li>For functioning a priority queue object requires two pools of blocks (See constructor of <a class="el" href="classstxxl_1_1priority__queue.html">stxxl::priority_queue</a>). To construct STXXL block pools you might need <b>block_type</b> that will be used by priority queue. Note that block's size and hence it's type is generated by the <a class="el" href="classstxxl_1_1PRIORITY__QUEUE__GENERATOR.html">stxxl::PRIORITY_QUEUE_GENERATOR</a> in compile type from <code>IntMemory</code>, <code>MaxItems</code> and <code>sizeof(ValueType)</code> and not given directly by user as a template parameter. Block type can be extracted as <a class="el" href="classstxxl_1_1priority__queue.html#ae772df4f34fc9e71f40527977e91a504">stxxl::PRIORITY_QUEUE_GENERATOR&lt;&gt;::result::block_type</a> (see <a class="el" href="tutorial_pqueue.html">STXXL Priority Queue</a>).</li>
<li>The configured priority queue type is available as <a class="el" href="classstxxl_1_1PRIORITY__QUEUE__GENERATOR.html#a8f0184d24343b89921850be2fa40d8c0">stxxl::PRIORITY_QUEUE_GENERATOR&lt;&gt;::result</a>.</li>
</ul>
<h1><a class="anchor" id="design_pqueue_memory"></a>
Internal Memory Consumption of stxxl::priority_queue</h1>
<p>Internal memory consumption of <a class="el" href="classstxxl_1_1priority__queue.html" title="External priority queue data structure   Introduction  to priority queue container: see STXXL Priorit...">stxxl::priority_queue</a> is bounded by the IntMemory template parameter in most situations. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Welcome to STXXL</a></li><li class="navelem"><a class="el" href="design.html">Design of STXXL</a></li><li class="navelem"><a class="el" href="design_stl.html">The STL-User Layer</a></li><li class="navelem"><a class="el" href="design_stl_containers.html">STXXL Containers</a></li>
    <li class="footer"><a href="http://stxxl.sourceforge.net">STXXL 1.4.1</a> - Generated on Wed Oct 29 2014 10:13:28 for STXXL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
