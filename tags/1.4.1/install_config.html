<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>STXXL: Disk Configuration Files</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">STXXL
   &#160;<span id="projectnumber">1.4.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('install_config.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Disk Configuration Files </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Timo Bingmann (2013-2014)</dd></dl>
<p>A main feature of the STXXL is to take advantage of parallel access to <b>multiple disks</b>. For this, you must define the disk configuration in a text file, using the syntax described below. If no file is found at the locations below, STXXL will by default create a 1000 MiB file in <code>/var/tmp/stxxl</code> on Unix or in the user's temp directory on Windows.</p>
<p>These are the locations STXXL will look for a disk configuration file on <b>Linux/Unix systems</b>, in order of precedence:</p>
<ul>
<li>If the environment variable <b><code>STXXLCFG</code></b> specifies a file, this is used.</li>
<li>Then the current directory of the program is checked:<ul>
<li>first for <b><code>.stxxl.$HOSTNAME</code></b> (for host specific configuration),</li>
<li>then for <b><code>.stxxl</code></b> (for general configuration).</li>
</ul>
</li>
<li>Then the <code>$HOME</code> directory of the current user is checked (<b>usual method</b>):<ul>
<li>first for <b><code>$HOME/.stxxl.$HOSTNAME</code></b> (for host specific configuration),</li>
<li>then for <b><code>$HOME/.stxxl</code></b> (for general configuration).</li>
</ul>
</li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>On many Linux distributions the <code>$HOSTNAME</code> variable is not exported. For the host specific configuration to work, you must add <code>"export HOSTNAME"</code> to your shell configuration (<code>.bashrc</code>).</dd></dl>
<p>On <b>Windows systems</b>, STXXL looks for a disk configuration file in the following directories:</p>
<ul>
<li>If the environment variable <b><code>STXXLCFG</code></b> specifies a file, this is used.</li>
<li>Then the current directory of the program is checked:<ul>
<li>first for <b><code>.stxxl.%COMPUTERNAME%.txt</code></b> (for host specific configuration),</li>
<li>then for <b><code>.stxxl.txt</code></b> (for general configuration).</li>
</ul>
</li>
<li>Then the <code>%APPDATA%</code> directory of the current user is checked (<b>usual method</b>):<ul>
<li>first for <b><code>%APPDATA%/.stxxl.%COMPUTERNAME%.txt</code></b> (for host specific configuration),</li>
<li>then for <b><code>%APPDATA%/.stxxl.txt</code></b> (for general configuration).</li>
</ul>
</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>In a default Windows 7 installation, %APPDATA% is <b><code>C:\Users\<em>&lt;username&gt;</em>\AppData\Roaming</code></b> <br/>
You can visit your <code>%APPDATA%</code> directory by simply entering <b><code>"%APPDATA%"</code></b> in the Windows Explorer address/location line.</dd></dl>
<h1><a class="anchor" id="install_config_format"></a>
Disk Configuration File Format</h1>
<p>Each line of the configuration file describes a disk. Lines starting with '#' are comments.</p>
<p>A disk description uses the following format: </p>
<pre class="fragment">disk=&lt;path&gt;,&lt;capacity&gt;,&lt;fileio&gt; &lt;options&gt;
</pre><p>Description of the parameters:</p>
<ul>
<li><b><code>&lt;path&gt;</code></b> : full disk filename.<ul>
<li>In order to access disks STXXL uses <em>file-based access methods</em> (see below). Each disk is represented as a file</li>
<li>If you have a disk that is mounted in Unix to the path /mnt/disk0/, then the correct value for the <code>full_disk_filename</code> would be <code>/mnt/disk0/some_file_name</code>. <br/>
</li>
<li>If the string contains <code>"###"</code> (three '#'), then these symbols are replaced by the current process id.</li>
</ul>
</li>
<li><b><code>&lt;capacity&gt;</code></b> : maximum capacity of the disk<ul>
<li>the following size suffixes are recognized:<ul>
<li><code>K</code>, <code>M</code>, <code>G</code>, <code>T</code>, <code>P</code> (powers of 10),</li>
<li><code>Ki</code>, <code>Mi</code>, <code>Gi</code>, <code>Ti</code>, <code>Pi</code> (powers of 2).</li>
<li>if a number has no suffix, <code>M</code> (megabyte) is assumed.</li>
</ul>
</li>
<li>0 means autogrow, and the file will be deleted afterwards.</li>
</ul>
</li>
<li><b><code>&lt;fileio&gt;</code></b> : <code>STXXL</code> has a number of different file access implementations, choose one of them (recommended ones in bold):<ul>
<li><code><b>syscall</b></code> : use <code>read</code> and <code>write</code> system calls which perform disk transfers directly on user memory pages without superfluous copying (currently the fastest method)</li>
<li><code><b>wincall</b></code> : on Windows, use direct calls to the Windows API.</li>
<li><code><b>linuxaio</b></code> : on Linux, use direct syscalls to the native Linux AIO interface. <br/>
 The Linux AIO interface has the advantage of keeping an asynchronous queue inside the kernel. Multiple I/O requests are submitted to the kernel at once, thus the kernel can sort then using its disk schedulers and also forward them to the actual disks as asynchronous operations using NCQ (native command queuing) or TCQ (tagged command queueing).</li>
<li><code>memory</code> : keeps all data in RAM, for quicker testing</li>
<li><code>mmap</code> : <code>use</code> <code>mmap</code> and <code>munmap</code> system calls</li>
<li><code>boostfd</code> : access the file using a Boost file descriptor</li>
<li><code>fileperblock_syscall</code>, <code>fileperblock_mmap</code>, <code>fileperblock_boostfd</code> : same as above, but take a single file per block, using full_disk_filename as file name prefix. Usually provide worse performance than the standard variants, but release freed blocks to the file system immediately.</li>
<li><code>simdisk</code> : simulates timings of the IBM IC35L080AVVA07 disk, full_disk_filename must point to a file on a RAM disk partition with sufficient space</li>
<li><code>wbtl</code> : library-based write-combining (good for writing small blocks onto SSDs), based on <code>syscall</code> </li>
</ul>
</li>
<li><b><code>&lt;options&gt;</code></b> : additional options for file access implementation. Not all are available for every fileio method. The option order is unimportant.<ul>
<li><code>autogrow</code> : enables automatic growth of the file beyond the specified capacity.</li>
<li><code><b>direct</b></code>, <code>nodirect</code>, <code>direct=</code>[off/try/on] : disable buffering in system cache by passing O_DIRECT or similar flag to open. <br/>
 This is <em>recommended</em> as it improves performance, however, not all filesystems support bypassing cache. With <code>direct</code> or <code>direct=on</code>, STXXL will fail without direct access. With <code>nodirect</code> or <code>direct=off</code> it is disabled. The default is <code>direct=try</code> , which first attempts to open with O_DIRECT and falls back to opening without if it fails.</li>
<li><code><b>unlink</b></code> (or <code>unlink_on_open</code>) : unlink the file from the fs immediately after creation. <br/>
 This is possible on Unix system, as the file descriptor is kept open. This method is <b>preferred</b>, because even in the case of a program segfault, the file data is cleaned up by the kernel.</li>
<li><code><b>delete</b></code> (or <code>delete_on_exit</code>) : delete file <em>after</em> the STXXL program exists <br/>
 This is the more conservative version of unlink, which also works on Windows. However, if the program crashes, the file is not deleted.</li>
<li><code><b>raw_device</b></code> : fail if the opened path is not a raw block device. <br/>
 This flag is not required, raw devices are automatically detected.</li>
<li><code>queue=#</code> : assign the disk to a specific I/O request queue and thread. <br/>
 Use this for multiple files that reside on the same physical disk.</li>
<li><code>devid=#</code> : assign the disk entry a specific physical device id. <br/>
 Usually you can just omit the devid=# option, since disks are enumerated automatically. In sorting and other prefetched operations, the physical device id is used to schedule block transfers from independent devices. Thus you should label files/disks on the same physical devices with the same devid.</li>
<li><code>queue_length=#</code> : specify for linuxaio the desired queue inside the linux kernel using this option.</li>
</ul>
</li>
</ul>
<p>Example: </p>
<pre class="fragment">disk=/data01/stxxl,500G,syscall unlink
disk=/data02/stxxl,300G,syscall unlink
</pre><p>On Windows, one usually uses different disk drives and <code>wincall</code>. </p>
<pre class="fragment">disk=c:\stxxl.tmp,700G,wincall delete
disk=d:\stxxl.tmp,200G,wincall delete
</pre><p>On Linux you can try to take advantage of NCQ + Kernel AIO queues: </p>
<pre class="fragment">disk=/data01/stxxl,500G,linuxaio unlink
disk=/data02/stxxl,300G,linuxaio unlink
</pre><h1><a class="anchor" id="install_config_filesystem"></a>
Recommended: File System XFS or Raw Block Devices</h1>
<p>The library benefits from direct transfers from user memory to disk, which saves superfluous copies. We recommend to use the <a href="http://xfs.org">XFS file system</a>, which gives good read and write performance for large files. Note that file creation speed of <code>XFS</code> is a bit slower, so that disk files should be precreated for optimal performance.</p>
<p>If the filesystems only use is to store one large STXXL disk file, we also recommend to add the following options to the <code>mkfs.xfs</code> command to gain maximum performance: </p>
<pre class="fragment">$ mkfs.xfs -d agcount=1 -l size=512b
</pre><p>The following filesystems have been reported not to support direct I/O: <code>tmpfs</code> , <code>glusterfs</code> . By default, STXXL will first try to use direct I/O (<code>O_DIRECT</code> open flag). If that fails, it will print a warning and open the file without <code>O_DIRECT</code>.</p>
<dl class="section note"><dt>Note</dt><dd>It is also possible to use <b>raw disk devices</b> with <code>syscall</code>. <br/>
Just use <code>disk=/dev/sdb1</code> or similar. This will of course <b>overwrite</b> all data on the partitions! The I/O performance of raw disks is generally <b>more stable and slightly higher</b> than with file systems. <div class="fragment"><div class="line">disk=/dev/sdb1,0,syscall raw_device</div>
</div><!-- fragment --> The <code>raw_device</code> flag is only for verification, STXXL will automatically detect raw block devices and also their size.</dd></dl>
<h1><a class="anchor" id="install_config_logfiles"></a>
Log Files</h1>
<p>STXXL produces two kinds of log files, a message and an error log. By setting the environment variables <code>STXXLLOGFILE</code> and <code>STXXLERRLOGFILE</code>, you can configure the location of these files. The default values are <code>stxxl.log</code> and <code>stxxl.errlog</code>, respectively.</p>
<h1><a class="anchor" id="install_config_precreation"></a>
Precreating External Memory Files</h1>
<p>In order to get the maximum performance one can precreate disk files described in the configuration file, before running STXXL applications. A precreation utility is included in the set of STXXL utilities in <code>stxxl_tool</code>. Run this utility for each disk you have defined in the disk configuration file: </p>
<pre class="fragment">$ stxxl_tool create_files &lt;capacity&gt; &lt;full_disk_filename...&gt;
// for example:
$ stxxl_tool create_files 1GiB /data01/stxxl
</pre><h1><a class="anchor" id="install_config_user"></a>
User-Supplied disk_config Structures</h1>
<p>With STXXL &gt;= 1.4.0, the library can also be configured via the user application.</p>
<p>All disk configuration is managed by the <a class="el" href="classstxxl_1_1config.html" title="Access point to disks properties. Since 1.4.0: no config files are read automatically! ...">stxxl::config</a> class, which contains a list of <a class="el" href="classstxxl_1_1disk__config.html" title="Encapsulate the configuration of one &quot;disk&quot;. The disk is actually a file I/O object which block_manag...">stxxl::disk_config</a> objects. Each <a class="el" href="classstxxl_1_1disk__config.html" title="Encapsulate the configuration of one &quot;disk&quot;. The disk is actually a file I/O object which block_manag...">stxxl::disk_config</a> object encapsulates one disk= lines from a config file, or one allocated disk.</p>
<p>The disk configuration must be supplied to the STXXL library <b>before any other function calls</b>, because the <a class="el" href="classstxxl_1_1config.html" title="Access point to disks properties. Since 1.4.0: no config files are read automatically! ...">stxxl::config</a> object must be filled before any external memory blocks are allocated by <a class="el" href="classstxxl_1_1block__manager.html" title="Block manager class. ">stxxl::block_manager</a>.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// get uninitialized config singleton</span></div>
<div class="line">    <a class="code" href="classstxxl_1_1config.html">stxxl::config</a> * cfg = <a class="code" href="classstxxl_1_1singleton.html#ab81b99f8fc8157a2a4b1bdab8afb454b">stxxl::config::get_instance</a>();</div>
<div class="line"></div>
<div class="line">    <span class="comment">// create a disk_config structure.</span></div>
<div class="line">    <a class="code" href="classstxxl_1_1disk__config.html">stxxl::disk_config</a> disk1(<span class="stringliteral">&quot;/tmp/stxxl.tmp&quot;</span>, 100 * 1024 * 1024, <span class="stringliteral">&quot;syscall unlink&quot;</span>);</div>
<div class="line">    disk1.direct = <a class="code" href="classstxxl_1_1disk__config.html#a679d8add46a52f3b114860c098aee98aa10dc9ad9a8f3f8333895ebda93a7d089">stxxl::disk_config::DIRECT_ON</a>; <span class="comment">// force O_DIRECT</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// add disk to config</span></div>
<div class="line">    cfg-&gt;<a class="code" href="classstxxl_1_1config.html#afce61f04e27a9c8cb267abd1412dccfb">add_disk</a>(disk1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// add another disk</span></div>
<div class="line">    cfg-&gt;<a class="code" href="classstxxl_1_1config.html#afce61f04e27a9c8cb267abd1412dccfb">add_disk</a>( disk_config(<span class="stringliteral">&quot;disk=/tmp/stxxl-2.tmp, 10 GiB, syscall unlink&quot;</span>) );</div>
<div class="line"></div>
<div class="line">    <span class="comment">// ... add more disks</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// use STXXL library as usual ...</span></div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Welcome to STXXL</a></li><li class="navelem"><a class="el" href="install.html">Compilation and Configuration</a></li>
    <li class="footer"><a href="http://stxxl.sourceforge.net">STXXL 1.4.1</a> - Generated on Wed Oct 29 2014 10:13:28 for STXXL by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
